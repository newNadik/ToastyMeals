<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçû Toasty Meals</title>
  <meta name="description" content="Let the toaster decide your next delicious meal">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      corePlugins: {
        outline: false,
      }
    }
  </script>
  <style>
    @keyframes steam {
      0% {
        opacity: 0;
        transform: translateY(0) scale(0.5);
      }
      20% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(1.5);
      }
    }
    
    /* Remove focus outlines and shadows - Safari specific */
    *,
    *::before,
    *::after {
      -webkit-tap-highlight-color: transparent !important;
      -webkit-touch-callout: none !important;
      outline: none !important;
      outline-width: 0 !important;
      outline-offset: 0 !important;
      box-shadow: none !important;
      -webkit-box-shadow: none !important;
    }
    
    * {
      -webkit-user-select: none;
      user-select: none;
    }
    
    button:focus,
    button:active,
    button:focus-visible,
    input:focus,
    input:active,
    input:focus-visible,
    *:focus,
    *:active,
    *:focus-visible {
      outline: 0 !important;
      outline-width: 0 !important;
      outline-offset: 0 !important;
      box-shadow: none !important;
      -webkit-box-shadow: none !important;
      border: none !important;
      ring: 0 !important;
    }
    
    /* Remove Tailwind focus ring */
    .focus\:outline-none:focus,
    *:focus {
      --tw-ring-shadow: 0 0 #0000 !important;
    }
    
    img {
      outline: none !important;
      border: none !important;
      -webkit-user-drag: none;
    }
    
    div:focus,
    div:active {
      outline: none !important;
      border: none !important;
    }
    
    button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const DEFAULT_MEALS = ['Pizza', 'Pasta', 'Sandwich'];

    // Lucide React icons as inline SVGs
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Menu = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    );

    const Sun = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
    );

    const Moon = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    );

    const ToastyMeals = () => {
      const [meals, setMeals] = useState([]);
      const [currentMeal, setCurrentMeal] = useState('');
      const [isToasting, setIsToasting] = useState(false);
      const [toastPhase, setToastPhase] = useState('idle');
      const [breadPosition, setBreadPosition] = useState(-110);
      const [isDragging, setIsDragging] = useState(false);
      const [showModal, setShowModal] = useState(false);
      const [newMeal, setNewMeal] = useState('');
      const [theme, setTheme] = useState('light');
      const [showSteam, setShowSteam] = useState(false);
      const [lastMeal, setLastMeal] = useState('');
      const [timerRotation, setTimerRotation] = useState(0);
      const [popAngle, setPopAngle] = useState(0);
      
      const leverRef = useRef(null);
      const startYRef = useRef(0);
      const toastTimeoutRef = useRef(null);

      useEffect(() => {
        const savedMeals = localStorage.getItem('toasty_meals_v2');
        const savedTheme = localStorage.getItem('toasty_theme');
        
        if (savedMeals) {
          setMeals(JSON.parse(savedMeals));
        } else {
          setMeals(DEFAULT_MEALS);
        }

        if (savedTheme) {
          setTheme(savedTheme);
        } else {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          setTheme(prefersDark ? 'dark' : 'dark'); // Default to dark
        }

        const handleKeyPress = (e) => {
          if (e.code === 'Space' && !showModal && !isToasting) {
            e.preventDefault();
            startToasting();
          }
        };

        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
      }, [showModal, isToasting]);

      useEffect(() => {
        if (meals.length > 0) {
          localStorage.setItem('toasty_meals_v2', JSON.stringify(meals));
        }
      }, [meals]);

      useEffect(() => {
        localStorage.setItem('toasty_theme', theme);
      }, [theme]);

      const selectRandomMeal = () => {
        const availableMeals = meals.length > 0 ? meals : DEFAULT_MEALS;
        if (availableMeals.length === 1) return availableMeals[0];
        
        let attempts = 0;
        let selected = availableMeals[Math.floor(Math.random() * availableMeals.length)];
        
        while (selected === lastMeal && attempts < 10) {
          selected = availableMeals[Math.floor(Math.random() * availableMeals.length)];
          attempts++;
        }
        
        return selected;
      };

      const startToasting = () => {
        if (isToasting) return;
        
        setIsToasting(true);
        setToastPhase('lowering');
        setCurrentMeal('');
        setBreadPosition(30);
        
        setTimeout(() => {
          setToastPhase('toasting');
          const toastDuration = 1500 + Math.random() * 1000;
          
          const startTime = Date.now();
          const animateTimer = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / toastDuration, 1);
            setTimerRotation(progress * 360);
            
            if (progress < 1) {
              requestAnimationFrame(animateTimer);
            }
          };
          animateTimer();
          
          toastTimeoutRef.current = setTimeout(() => {
            const newMeal = selectRandomMeal();
            const randomAngle = ((Date.now() % 100) / 100 - 0.5) * 20;
            
            setLastMeal(newMeal);
            setCurrentMeal(newMeal);
            setPopAngle(randomAngle);
            setToastPhase('popping');
            setBreadPosition(-180);
            setShowSteam(true);
            
            setTimeout(() => {
              setToastPhase('idle');
              setBreadPosition(-110);
              setPopAngle(0);
              setIsToasting(false);
              setShowSteam(false);
              setTimerRotation(0);
            }, 600);
          }, toastDuration);
        }, 500);
      };

      const handleMouseDown = (e) => {
        if (isToasting) return;
        setIsDragging(true);
        startYRef.current = e.clientY || e.touches?.[0]?.clientY || 0;
      };

      const handleMouseMove = (e) => {
        if (!isDragging || isToasting) return;
        const currentY = e.clientY || e.touches?.[0]?.clientY || 0;
        const deltaY = currentY - startYRef.current;
        const newPosition = Math.max(-110, Math.min(30, -110 + deltaY));
        setBreadPosition(newPosition);
      };

      const handleMouseUp = () => {
        if (!isDragging) return;
        setIsDragging(false);
        
        if (breadPosition > -70) {
          startToasting();
        } else {
          setBreadPosition(-130);
        }
      };

      useEffect(() => {
        if (isDragging) {
          window.addEventListener('mousemove', handleMouseMove);
          window.addEventListener('mouseup', handleMouseUp);
          window.addEventListener('touchmove', handleMouseMove);
          window.addEventListener('touchend', handleMouseUp);
          
          return () => {
            window.removeEventListener('mousemove', handleMouseMove);
            window.removeEventListener('mouseup', handleMouseUp);
            window.removeEventListener('touchmove', handleMouseMove);
            window.removeEventListener('touchend', handleMouseUp);
          };
        }
      }, [isDragging, breadPosition]);

      const addMeal = () => {
        const trimmed = newMeal.trim();
        if (trimmed && !meals.includes(trimmed)) {
          setMeals([...meals, trimmed]);
          setNewMeal('');
        }
      };

      const deleteMeal = (mealToDelete) => {
        setMeals(meals.filter(m => m !== mealToDelete));
      };

      const toggleTheme = () => {
        setTheme(theme === 'light' ? 'dark' : 'light');
      };

      return (
        <div 
          className="min-h-screen transition-colors flex flex-col relative"
          style={{
            backgroundColor: theme === 'light' ? '#fef1d6' : '#1a1a1a',
            backgroundImage: theme === 'light' ? `url('./images/background.png')` : `url('./images/background_dark.png')`,
            backgroundPosition: 'bottom center',
            backgroundRepeat: 'no-repeat',
            backgroundSize: 'auto 100%'
          }}
        >
          {/* Header */}
          <header className="pt-16 pb-6 flex flex-col items-center relative z-20">
            <div className="flex items-center gap-3 mb-3">
              <span className="text-5xl">üçû</span>
              <h1 className="text-5xl font-bold" style={{ color: theme === 'light' ? '#8B7355' : '#fff' }}>
                Toasty Meals
              </h1>
            </div>
            <p className="text-lg opacity-80 text-center max-w-md" style={{ color: theme === 'light' ? '#8B7355' : '#ccc' }}>
              Let the toaster decide your next delicious meal
            </p>
            
            {/* Theme and Menu buttons - positioned in top right corner */}
            <div className="absolute top-6 right-6 flex gap-2">
              <button
                onClick={toggleTheme}
                className="p-2 rounded-lg backdrop-blur-sm transition-colors"
                style={{
                  backgroundColor: theme === 'light' ? 'rgba(255,255,255,0.5)' : 'rgba(50,50,50,0.5)',
                  color: theme === 'light' ? '#8B7355' : '#fff'
                }}
              >
                {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}
              </button>
              <button
                onClick={() => setShowModal(true)}
                className="p-2 rounded-lg backdrop-blur-sm transition-colors"
                style={{
                  backgroundColor: theme === 'light' ? 'rgba(255,255,255,0.5)' : 'rgba(50,50,50,0.5)',
                  color: theme === 'light' ? '#8B7355' : '#fff'
                }}
              >
                <Menu size={20} />
              </button>
            </div>
          </header>

          {/* Main Content */}
          <div className="flex-1 flex flex-col items-center justify-start pt-8 p-4 relative z-10">
            <div className="relative flex flex-col items-center">
              {/* Container for bread and toaster */}
              <div className="relative" style={{ width: '600px', height: '500px' }}>
                
                {/* Toaster Body */}
                <div 
                  className="absolute left-1/2 -translate-x-1/2"
                  style={{
                    bottom: '-100px',
                    width: '500px',
                    height: 'auto',
                    zIndex: 2
                  }}
                >
                  <img 
                    src="./images/toaster_body.png" 
                    alt="Toaster"
                    className="w-full h-auto"
                    style={{ filter: 'drop-shadow(0 10px 30px rgba(0,0,0,0.15))' }}
                  />
                  
                  {/* Timer Dial - positioned over toaster */}
                  <div
                    className="absolute"
                    style={{
                      right: '75px',
                      top: '186px',
                      width: '70px',
                      height: '70px',
                      transform: `rotate(${
                        toastPhase === 'toasting' 
                          ? 330 - timerRotation 
                          : Math.max(0, ((breadPosition + 110) / 140) * 330)
                      }deg)`,
                      transition: toastPhase === 'toasting' ? 'none' : isDragging ? 'none' : 'transform 0.5s ease-out',
                      transformOrigin: 'center center'
                    }}
                  >
                    <img 
                      src="./images/toaster_knob.png" 
                      alt="Timer"
                      className="w-full h-full"
                    />
                  </div>

                  {/* Lever Handle - positioned over toaster */}
                  <div
                    ref={leverRef}
                    className="absolute cursor-grab active:cursor-grabbing focus:outline-none"
                    style={{
                      left: '73px',
                      top: '140px',
                      width: '50px',
                      height: 'auto',
                      transform: `translateY(${(breadPosition + 110) / 140 * 60}px)`,
                      transition: isDragging ? 'none' : 'transform 0.5s ease-out',
                      zIndex: 3,
                      outline: 'none',
                      border: 'none'
                    }}
                    onMouseDown={handleMouseDown}
                    onTouchStart={handleMouseDown}
                  >
                    <img 
                      src="./images/toaster_leverage.png" 
                      alt="Lever"
                      className="w-full h-auto"
                    />
                  </div>
                </div>

                {/* Toast/Bread */}
                <div
                  className="absolute left-1/2 -translate-x-1/2 transition-all"
                  style={{
                    bottom: `${120 - breadPosition}px`,
                    width: '220px',
                    transform: `translateX(-50%) rotate(${popAngle}deg) scale(${toastPhase === 'popping' ? '1.1' : '1'})`,
                    opacity: 1,
                    transitionDuration: isDragging ? '0s' : toastPhase === 'popping' ? '600ms' : toastPhase === 'idle' ? '350ms' : '500ms',
                    transitionTimingFunction: toastPhase === 'popping' ? 'cubic-bezier(0.34, 1.56, 0.64, 1)' : toastPhase === 'idle' ? 'cubic-bezier(0.5, 1.5, 0.5, 1)' : 'ease-out',
                    zIndex: 1,
                    filter: 'drop-shadow(0 5px 15px rgba(0,0,0,0.2))'
                  }}
                >
                  <div className="relative">
                    <img 
                      src="./images/toast.png" 
                      alt="Toast"
                      className="w-full h-auto"
                    />
                    
                    {/* Meal text overlay */}
                    <div className="absolute inset-0 flex items-center justify-center px-4">
                      <p className="text-2xl font-bold text-amber-900 text-center leading-tight drop-shadow-sm">
                        {currentMeal || 'What to cook today?'}
                      </p>
                    </div>
                  </div>
                </div>

                {/* Steam effect */}
                {showSteam && (
                  <div className="absolute left-1/2 -translate-x-1/2" style={{ bottom: '350px', zIndex: 20 }}>
                    {[0, 1, 2, 3].map((i) => (
                      <div
                        key={i}
                        className="absolute rounded-full"
                        style={{
                          left: `${i * 20 - 30}px`,
                          width: '25px',
                          height: '25px',
                          background: 'radial-gradient(circle, rgba(255,255,255,0.6), rgba(255,255,255,0.1))',
                          animation: `steam 2s ease-out ${i * 0.15}s`,
                          filter: 'blur(4px)'
                        }}
                      />
                    ))}
                  </div>
                )}
              </div>

              {/* Toast Button */}
              <button
                onClick={startToasting}
                disabled={isToasting}
                className="px-10 py-4 font-bold rounded-full transition-all shadow-lg transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-0"
                style={{
                  background: 'linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)',
                  color: '#fff',
                  opacity: isToasting ? 0.6 : 1,
                  cursor: isToasting ? 'not-allowed' : 'pointer',
                  position: 'absolute',
                  bottom: '-130px',
                  zIndex: 30,
                  border: 'none',
                  outline: 'none'
                }}
              >
                {isToasting ? 'Toasting...' : 'What to cook today?'}
              </button>
            </div>
          </div>

          {/* Modal */}
          {showModal && (
            <div
              className="fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50"
              style={{ backgroundColor: 'rgba(0,0,0,0.4)' }}
              onClick={() => setShowModal(false)}
            >
              <div
                className="rounded-2xl max-w-md w-full max-h-[80vh] flex flex-col shadow-2xl"
                style={{ backgroundColor: theme === 'dark' ? '#2a2a2a' : '#fff' }}
                onClick={(e) => e.stopPropagation()}
              >
                <div 
                  className="p-5 border-b flex justify-between items-center"
                  style={{ borderColor: theme === 'dark' ? '#444' : '#e5e5e5' }}
                >
                  <div>
                    <h2 className="text-xl font-bold" style={{ color: theme === 'dark' ? '#fff' : '#8B7355' }}>
                      Your Meals
                    </h2>
                    <p className="text-sm opacity-70 mt-1" style={{ color: theme === 'dark' ? '#ccc' : '#8B7355' }}>
                      Add your favorite meals to get random suggestions
                    </p>
                  </div>
                  <button 
                    onClick={() => setShowModal(false)} 
                    className="p-2 rounded-lg transition-colors"
                    style={{
                      backgroundColor: theme === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)',
                      color: theme === 'dark' ? '#fff' : '#8B7355'
                    }}
                  >
                    <X size={20} />
                  </button>
                </div>

                <div className="p-5 overflow-y-auto">
                  <div className="flex gap-2 mb-4">
                    <input
                      type="text"
                      value={newMeal}
                      onChange={(e) => setNewMeal(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && addMeal()}
                      placeholder="Add a meal..."
                      className="flex-1 px-4 py-2 rounded-lg border-2 focus:outline-none transition-all"
                      style={{
                        backgroundColor: theme === 'dark' ? '#3a3a3a' : '#f9f9f9',
                        borderColor: theme === 'dark' ? '#555' : '#e5e5e5',
                        color: theme === 'dark' ? '#fff' : '#333'
                      }}
                    />
                    <button
                      onClick={addMeal}
                      className="p-2 text-white rounded-lg transition-all shadow-md"
                      style={{ background: 'linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)' }}
                    >
                      <Plus size={22} />
                    </button>
                  </div>

                  <div className="space-y-2">
                    {(meals.length > 0 ? meals : DEFAULT_MEALS).map((meal, idx) => (
                      <div
                        key={idx}
                        className="flex justify-between items-center p-3 rounded-lg transition-all"
                        style={{
                          backgroundColor: theme === 'dark' ? '#3a3a3a' : '#f5f5f5',
                          color: theme === 'dark' ? '#fff' : '#333'
                        }}
                      >
                        <span className="font-medium">{meal}</span>
                        {meals.length > 0 && (
                          <button
                            onClick={() => deleteMeal(meal)}
                            className="p-1.5 hover:bg-red-500 hover:text-white rounded-lg transition-all"
                          >
                            <X size={18} />
                          </button>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<ToastyMeals />, document.getElementById('root'));
  </script>
</body>
</html>