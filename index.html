<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçû Toasty Meals</title>
  <meta name="description" content="A fun, interactive meal decision app using a toaster metaphor">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes steam {
      0% {
        opacity: 0;
        transform: translateY(0);
      }
      50% {
        opacity: 0.6;
      }
      100% {
        opacity: 0;
        transform: translateY(-60px);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const DEFAULT_MEALS = ['Pizza', 'Pasta', 'Tacos', 'Salad', 'Soup', 'Sandwich'];

    // Lucide React icons as inline SVGs
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Menu = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    );

    const Sun = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
    );

    const Moon = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    );

    const ToastyMeals = () => {
      const [meals, setMeals] = useState([]);
      const [currentMeal, setCurrentMeal] = useState('');
      const [isToasting, setIsToasting] = useState(false);
      const [toastPhase, setToastPhase] = useState('idle');
      const [breadPosition, setBreadPosition] = useState(-130);
      const [isDragging, setIsDragging] = useState(false);
      const [showModal, setShowModal] = useState(false);
      const [newMeal, setNewMeal] = useState('');
      const [theme, setTheme] = useState('light');
      const [showSteam, setShowSteam] = useState(false);
      const [lastMeal, setLastMeal] = useState('');
      const [timerRotation, setTimerRotation] = useState(0);
      const [popAngle, setPopAngle] = useState(0);
      
      const leverRef = useRef(null);
      const startYRef = useRef(0);
      const toastTimeoutRef = useRef(null);

      useEffect(() => {
        const savedMeals = localStorage.getItem('toasty_meals_v2');
        const savedTheme = localStorage.getItem('toasty_theme');
        
        if (savedMeals) {
          setMeals(JSON.parse(savedMeals));
        } else {
          setMeals(DEFAULT_MEALS);
        }

        if (savedTheme) {
          setTheme(savedTheme);
        } else {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          setTheme(prefersDark ? 'dark' : 'light');
        }

        const handleKeyPress = (e) => {
          if (e.code === 'Space' && !showModal && !isToasting) {
            e.preventDefault();
            startToasting();
          }
        };

        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
      }, [showModal, isToasting]);

      useEffect(() => {
        if (meals.length > 0) {
          localStorage.setItem('toasty_meals_v2', JSON.stringify(meals));
        }
      }, [meals]);

      useEffect(() => {
        localStorage.setItem('toasty_theme', theme);
      }, [theme]);

      const selectRandomMeal = () => {
        const availableMeals = meals.length > 0 ? meals : DEFAULT_MEALS;
        if (availableMeals.length === 1) return availableMeals[0];
        
        let attempts = 0;
        let selected = availableMeals[Math.floor(Math.random() * availableMeals.length)];
        
        while (selected === lastMeal && attempts < 10) {
          selected = availableMeals[Math.floor(Math.random() * availableMeals.length)];
          attempts++;
        }
        
        return selected;
      };

      const startToasting = () => {
        if (isToasting) return;
        
        setIsToasting(true);
        setToastPhase('lowering');
        setCurrentMeal('');
        setBreadPosition(30);
        
        setTimeout(() => {
          setToastPhase('toasting');
          const toastDuration = 1500 + Math.random() * 1000;
          
          const startTime = Date.now();
          const animateTimer = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / toastDuration, 1);
            setTimerRotation(progress * 360);
            
            if (progress < 1) {
              requestAnimationFrame(animateTimer);
            }
          };
          animateTimer();
          
          toastTimeoutRef.current = setTimeout(() => {
            const newMeal = selectRandomMeal();
            const randomAngle = ((Date.now() % 100) / 100 - 0.5) * 20;
            
            setLastMeal(newMeal);
            setCurrentMeal(newMeal);
            setPopAngle(randomAngle);
            setToastPhase('popping');
            setBreadPosition(-180);
            setShowSteam(true);
            
            setTimeout(() => {
              setToastPhase('idle');
              setBreadPosition(-130);
              setPopAngle(0);
              setIsToasting(false);
              setShowSteam(false);
              setTimerRotation(0);
            }, 600);
          }, toastDuration);
        }, 500);
      };

      const handleMouseDown = (e) => {
        if (isToasting) return;
        setIsDragging(true);
        startYRef.current = e.clientY || e.touches?.[0]?.clientY || 0;
      };

      const handleMouseMove = (e) => {
        if (!isDragging || isToasting) return;
        const currentY = e.clientY || e.touches?.[0]?.clientY || 0;
        const deltaY = currentY - startYRef.current;
        const newPosition = Math.max(-130, Math.min(30, -130 + deltaY));
        setBreadPosition(newPosition);
      };

      const handleMouseUp = () => {
        if (!isDragging) return;
        setIsDragging(false);
        
        if (breadPosition > -70) {
          startToasting();
        } else {
          setBreadPosition(-130);
        }
      };

      useEffect(() => {
        if (isDragging) {
          window.addEventListener('mousemove', handleMouseMove);
          window.addEventListener('mouseup', handleMouseUp);
          window.addEventListener('touchmove', handleMouseMove);
          window.addEventListener('touchend', handleMouseUp);
          
          return () => {
            window.removeEventListener('mousemove', handleMouseMove);
            window.removeEventListener('mouseup', handleMouseUp);
            window.removeEventListener('touchmove', handleMouseMove);
            window.removeEventListener('touchend', handleMouseUp);
          };
        }
      }, [isDragging, breadPosition]);

      const addMeal = () => {
        const trimmed = newMeal.trim();
        if (trimmed && !meals.includes(trimmed)) {
          setMeals([...meals, trimmed]);
          setNewMeal('');
        }
      };

      const deleteMeal = (mealToDelete) => {
        setMeals(meals.filter(m => m !== mealToDelete));
      };

      const toggleTheme = () => {
        setTheme(theme === 'light' ? 'dark' : 'light');
      };

      return (
        <div className={`min-h-screen ${theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-white text-gray-900'} transition-colors flex flex-col`}>
          {/* Header */}
          <header className="p-4 flex justify-between items-center max-w-2xl mx-auto w-full">
            <div className="flex items-center gap-2">
              <span className="text-2xl">üçû</span>
              <h1 className="text-xl font-bold">Toasty Meals</h1>
            </div>
            <div className="flex gap-2">
              <button
                onClick={toggleTheme}
                className={`p-2 rounded-lg ${theme === 'dark' ? 'hover:bg-gray-800' : 'hover:bg-gray-100'}`}
              >
                {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}
              </button>
              <button
                onClick={() => setShowModal(true)}
                className={`p-2 rounded-lg ${theme === 'dark' ? 'hover:bg-gray-800' : 'hover:bg-gray-100'}`}
              >
                <Menu size={20} />
              </button>
            </div>
          </header>

          {/* Main Content */}
          <div className="flex-1 flex flex-col items-center justify-center p-4">
            <div className="relative flex flex-col items-center">
              {/* Container for bread and toaster */}
              <div className="relative" style={{ height: '240px' }}>
                {/* Toaster */}
                <div className={`absolute top-0 left-1/2 -translate-x-1/2 w-64 h-48 ${theme === 'dark' ? 'bg-gray-800' : 'bg-gray-700'} rounded-lg shadow-xl`} style={{ zIndex: 2 }}>
                  {/* Chrome top */}
                  <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-b from-gray-300 to-gray-400 rounded-t-lg" />
                  
                  {/* Timer dial */}
                  <div className="absolute top-8 right-8 w-12 h-12 bg-gray-900 rounded-full flex items-center justify-center">
                    <div className="w-10 h-10 bg-gray-800 rounded-full relative">
                      <div
                        className="absolute top-1 left-1/2 w-0.5 h-4 bg-orange-500 origin-bottom"
                        style={{
                          transform: `translateX(-50%) rotate(${
                            toastPhase === 'toasting' 
                              ? 330 - timerRotation 
                              : Math.max(0, ((breadPosition + 130) / 160) * 330)
                          }deg)`,
                          transition: toastPhase === 'toasting' ? 'none' : isDragging ? 'none' : 'transform 0.5s ease-out',
                        }}
                      />
                    </div>
                  </div>

                  {/* Lever */}
                  <div
                    ref={leverRef}
                    className="absolute top-12 left-8 w-6 h-16 bg-gray-600 rounded cursor-grab active:cursor-grabbing flex items-center justify-center"
                    style={{
                      transform: `translateY(${(breadPosition + 130) / 160 * 60}px)`,
                      transition: isDragging ? 'none' : 'transform 0.5s ease-out',
                      zIndex: 10,
                    }}
                    onMouseDown={handleMouseDown}
                    onTouchStart={handleMouseDown}
                  >
                    <div className="w-3 h-3 bg-orange-500 rounded-full" />
                  </div>

                  {/* Feet */}
                  <div className="absolute -bottom-3 left-8 w-8 h-4 bg-gray-800 rounded-b" />
                  <div className="absolute -bottom-3 right-8 w-8 h-4 bg-gray-800 rounded-b" />
                </div>

                {/* Bread - positioned to go behind toaster body but in front when popped */}
                <div
                  className="absolute transition-all"
                  style={{
                    top: `${breadPosition}px`,
                    left: '50%',
                    transform: `translateX(-50%) rotate(${popAngle}deg) scale(${toastPhase === 'popping' ? '1.1' : '1'})`,
                    opacity: toastPhase === 'toasting' ? 0 : 1,
                    transitionDuration: isDragging ? '0s' : toastPhase === 'popping' ? '600ms' : toastPhase === 'idle' ? '350ms' : '500ms',
                    transitionTimingFunction: toastPhase === 'popping' ? 'cubic-bezier(0.34, 1.56, 0.64, 1)' : toastPhase === 'idle' ? 'cubic-bezier(0.5, 1.5, 0.5, 1)' : 'ease-out',
                    zIndex: 1,
                  }}
                >
                  <div className="relative w-32 h-40 bg-gradient-to-b from-amber-200 to-amber-300 rounded-t-3xl flex items-center justify-center shadow-lg">
                    <div className="absolute top-0 left-0 right-0 h-8 bg-amber-300 rounded-t-3xl" style={{
                      clipPath: 'polygon(10% 0%, 20% 15%, 35% 8%, 50% 18%, 65% 10%, 80% 20%, 90% 5%, 100% 0%, 100% 100%, 0% 100%, 0% 0%)'
                    }} />
                    {currentMeal && (toastPhase === 'idle' || toastPhase === 'popping') && (
                      <p className="text-lg font-bold text-gray-800 z-10 px-4 text-center">{currentMeal}</p>
                    )}
                  </div>
                </div>

                {/* Steam */}
                {showSteam && (
                  <div className="absolute top-0 left-1/2 -translate-x-1/2" style={{ top: '-100px', zIndex: 20 }}>
                    {[0, 1, 2].map((i) => (
                      <div
                        key={i}
                        className="absolute w-4 h-4 bg-white/40 rounded-full"
                        style={{
                          left: `${i * 20 - 20}px`,
                          animation: `steam 1.5s ease-out ${i * 0.2}s`,
                        }}
                      />
                    ))}
                  </div>
                )}
              </div>

              {/* Toast Button */}
              <button
                onClick={startToasting}
                disabled={isToasting}
                className="mt-8 px-8 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white font-semibold rounded-full transition-all"
              >
                {isToasting ? 'Toasting...' : 'Toast'}
              </button>
            </div>
          </div>

          {/* Modal */}
          {showModal && (
            <div
              className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
              onClick={() => setShowModal(false)}
            >
              <div
                className={`${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} rounded-lg max-w-md w-full max-h-[80vh] flex flex-col`}
                onClick={(e) => e.stopPropagation()}
              >
                {/* Modal Header */}
                <div className="p-4 border-b border-gray-300 dark:border-gray-700 flex justify-between items-center">
                  <h2 className="text-lg font-bold">Your Meals</h2>
                  <button onClick={() => setShowModal(false)} className="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
                    <X size={20} />
                  </button>
                </div>

                {/* Modal Content */}
                <div className="p-4 overflow-y-auto">
                  <div className="flex gap-2 mb-4">
                    <input
                      type="text"
                      value={newMeal}
                      onChange={(e) => setNewMeal(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && addMeal()}
                      placeholder="Add a meal..."
                      className={`flex-1 px-3 py-2 rounded border ${
                        theme === 'dark' 
                          ? 'bg-gray-700 border-gray-600' 
                          : 'bg-white border-gray-300'
                      }`}
                    />
                    <button
                      onClick={addMeal}
                      className="p-2 bg-orange-500 hover:bg-orange-600 text-white rounded"
                    >
                      <Plus size={20} />
                    </button>
                  </div>

                  <div className="space-y-2">
                    {(meals.length > 0 ? meals : DEFAULT_MEALS).map((meal, idx) => (
                      <div
                        key={idx}
                        className={`flex justify-between items-center p-3 rounded ${
                          theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'
                        }`}
                      >
                        <span>{meal}</span>
                        {meals.length > 0 && (
                          <button
                            onClick={() => deleteMeal(meal)}
                            className="p-1 hover:bg-red-500 hover:text-white rounded"
                          >
                            <X size={16} />
                          </button>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<ToastyMeals />, document.getElementById('root'));
  </script>
</body>
</html>